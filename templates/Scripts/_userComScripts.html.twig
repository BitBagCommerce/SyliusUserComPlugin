{% set genderMap =  constant('BitBag\\SyliusUserComPlugin\\Builder\\Payload\\CustomerPayloadBuilderInterface::GENDER_MAP')%}
{% set active =  constant('BitBag\\SyliusUserComPlugin\\Builder\\Payload\\CustomerPayloadBuilderInterface::STATUS_USER')%}
{% set visitor =  constant('BitBag\\SyliusUserComPlugin\\Builder\\Payload\\CustomerPayloadBuilderInterface::STATUS_VISITOR')%}
{% set customer = sylius.customer|default(null) %}
{% if customer is not null %}
    <script data-cfasync="false">
        const user_com_customer_info = {
            {% if customer.fullName is not empty %}
                name: "{{ customer.fullName }}",
            {% endif %}
            {% if customer.email is not empty %}
                user_id: "{{ customer.email }}",
                email: "{{ customer.email }}",
            {% endif %}
            {% if customer.phoneNumber is not empty %}
                phone_number: "{{ customer.phoneNumber }}",
            {% endif %}
            {% if customer.gender in genderMap and genderMap[customer.gender] in [2, 3] %}
                gender: {{ genderMap[customer.gender] }},
            {% else %}
                gender: undefined,
            {% endif %}
            status: {{ active }}
        };
    </script>
{% else %}
    <script data-cfasync="false">
        const user_com_customer_info = {
            status: {{ visitor }}
        };
    </script>
{% endif %}
{% set apiAwareResource = getUserComApiAwareResource() %}

{% if null != apiAwareResource and null != apiAwareResource.userComGTMContainerId %}
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer',"{{ apiAwareResource.userComGTMContainerId }}");</script>
    <!-- End Google Tag Manager -->
{% endif %}
