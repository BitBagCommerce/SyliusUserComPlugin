{% set genderMap =  constant('BitBag\\SyliusUserComPlugin\\Builder\\Payload\\CustomerPayloadBuilderInterface::GENDER_MAP')%}
{% set active =  constant('BitBag\\SyliusUserComPlugin\\Builder\\Payload\\CustomerPayloadBuilderInterface::STATUS_USER')%}
{% set visitor =  constant('BitBag\\SyliusUserComPlugin\\Builder\\Payload\\CustomerPayloadBuilderInterface::STATUS_VISITOR')%}
{% set customer = sylius.customer|default(null) %}
<script data-cfasync="false">const user_com_customer_info= {
        name: "{{ customer.name|default(null) }}",
        user_id: "{{ customer.email|default(null) }}",
        email: "{{ customer.email|default(null) }}",
        gender: {{ null != customer ? genderMap[customer.gender] : genderMap['u'] }},
        status: {{ null != customer ? active : visitor }},
        phone_number: "{{ customer.phone_number|default(null)}}",
    }
</script>
{% set apiAwareResource = getUserComApiAwareResource() %}

{% if null != apiAwareResource and null != apiAwareResource.userComGTMContainerId %}
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer',"{{ apiAwareResource.userComGTMContainerId }}");</script>
    <!-- End Google Tag Manager -->
{% endif %}
