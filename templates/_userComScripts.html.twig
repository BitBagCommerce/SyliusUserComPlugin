
{% set genderMap =  constant('BitBag\\SyliusUserComPlugin\\Builder\\Payload\\CustomerPayloadBuilderInterface::GENDER_MAP')%}
{% set active =  constant('BitBag\\SyliusUserComPlugin\\Builder\\Payload\\CustomerPayloadBuilderInterface::STATUS_USER')%}
{% set visitor =  constant('BitBag\\SyliusUserComPlugin\\Builder\\Payload\\CustomerPayloadBuilderInterface::STATUS_VISITOR')%}
{% set customer = sylius.customer|default(null) %}
<script data-cfasync="false">const user_com_customer_info= {
        name: "{{ customer.name|default(null) }}",
        user_id: "{{ customer.email|default(null) }}",
        email: "{{ customer.email|default(null) }}",
        gender: {{ null != customer ? genderMap[customer.gender] : genderMap['u'] }},
        status: {{ null != customer ? active : visitor }},
        phone_number: "{{ customer.phone_number|default(null)}}",
    }
</script>

<!-- Google tag (gtag.js), plugin provided by Spinbits -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ id }}{{ url_suffix|raw }}"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){window.dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ id }}');
    if (window.performance) {
        gtag('event', 'timing_complete', {
            'name': 'load',
            'value': Math.round(performance.now()),
            'event_category': 'JS Dependencies'
        });
    }
    {% if app.session is not null and app.session.started %}
        {% set events = app.session.bag('spinbits_ga4_events').all %}
        {% for event, content in events %}
            {% for c in content %}
                gtag("event", "{{ event }}", {{ c|raw }});
            {% endfor %}
        {% endfor %}
    {% endif %}
</script>
